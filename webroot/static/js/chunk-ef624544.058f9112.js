(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef624544"],{"90f1":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wrap"},[r("el-form",{model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.recOpen}},[e._v("打开录音,请求权限")]),r("el-button",{attrs:{type:"primary"},on:{click:e.recClose}},[e._v("关闭录音,释放资源")]),r("el-button",{attrs:{type:"primary"},on:{click:e.recStart}},[e._v("录制")]),r("el-button",{staticStyle:{"margin-right":"80px"},attrs:{type:"primary"},on:{click:e.recStop}},[e._v("停止")]),r("el-divider"),r("span",[e._v(e._s(e.form.tip))]),r("el-divider"),r("div",{staticClass:"ctrlProcessWave"}),e.form.audioUrl?r("audio",{attrs:{src:e.form.audioUrl,controls:"controls"}}):e._e()],1)],1)],1)},o=[],a=(r("8300"),r("ea5b"),r("e551"),r("2f76"),r("49c7"),r("b900")),i=r("712a"),s=r.n(i),c=(r("0bf9"),{data:function(){return{form:{time:"按住说话(60秒)",tip:"先打开录音，点击录制按钮开始说话",audioUrl:""},num:60,recorder:null,interval:"",audioFileList:[],startTime:"",endTime:"",Rec:s.a,type:"wav",bitRate:16,sampleRate:16e3,rec:0,duration:0,powerLevel:0,recOpenDialogShow:0,logs:[]}},methods:{clearTimer:function(){this.interval&&(this.num=60,clearInterval(this.interval))},mouseStart:function(){var e=this;this.clearTimer(),this.startTime=(new Date).getTime(),a["a"].get((function(t){t&&(e.flag?(e.mouseEnd(),e.flag=!1):(e.recorder=t,e.interval=setInterval((function(){e.num<=0?(e.recorder.stop(),e.num=60,e.clearTimer()):(e.num--,e.form.time="松开结束（"+e.num+"秒）",e.recorder.start())}),1e3)))}))},mouseEnd:function(){if(this.clearTimer(),this.endTime=(new Date).getTime(),this.recorder){this.recorder.stop(),this.num=60,this.form.time="按住说话（"+this.num+"秒）";var e=this.recorder.getBlob();console.log(e.arrayBuffer());var t=new File([e],"test.mp3",{type:"audio/mp3",lastModified:Date.now()});console.log(t),this.form.audioUrl=window.URL.createObjectURL(e);var r=new FileReader;r.onloadend=function(e){var t=e.target.result;console.log(t)},r.readAsDataURL(e);var n=new FormData;n.append("file",t),console.log(n)}},recOpen:function(){var e=this,t=this.rec=s()({type:e.type,bitRate:e.bitRate,sampleRate:e.sampleRate,onProcess:function(t,r,n,o){e.duration=n,e.powerLevel=r}});e.dialogInt=setTimeout((function(){}),8e3),t.open((function(){console.log("已打开:"+e.type+" "+e.sampleRate+"hz "+e.bitRate+"kbps",2)}),(function(e,t){console.log((t?"UserNotAllow，":"")+"打开失败："+e,1)})),e.waitDialogClickFn=function(){console.log("打开失败：权限请求被忽略，用户主动点击的弹窗",1)}},recClose:function(){var e=this.rec;this.rec=null,e?(e.close(),console.log("已关闭")):console.log("未打开录音",1)},recStart:function(){if(this.rec&&s.a.IsOpen()){this.rec.start();var e=this.rec.set;console.log("录制中："+e.type+" "+e.sampleRate+"hz "+e.bitRate+"kbps")}else console.log("未打开录音",1)},recPause:function(){this.rec&&s.a.IsOpen()?this.rec.pause():console.log("未打开录音",1)},recResume:function(){this.rec&&s.a.IsOpen()?this.rec.resume():console.log("未打开录音",1)},recStop:function(){if(this.rec&&s.a.IsOpen()){var e=this,t=e.rec;t.stop((function(r,n){console.log("已录制:","",{blob:r,duration:n,rec:t}),e.form.audioUrl=window.URL.createObjectURL(r);var o=new FileReader;o.onloadend=function(e){var t=e.target.result;console.log(t)},o.readAsDataURL(r)}),(function(e){console.log("录音失败："+e,1)}))}else console.log("未打开录音",1)}}}),l=c,u=r("cba8"),d=Object(u["a"])(l,n,o,!1,null,"34a1895e",null);t["default"]=d.exports},b900:function(e,t,r){"use strict";r("8300"),r("ea5b"),r("e551"),r("2f76"),r("49c7"),r("2904"),r("71ae"),r("da44"),r("d653"),r("3d2c"),r("0c7a"),r("24d5"),r("79ad"),r("16a4"),r("b7b1"),r("b0b7"),r("deea"),r("816b"),r("eec2"),r("58a1"),r("fcde"),r("c26d"),r("d933"),r("233e"),r("2c1f"),r("1953"),r("9cb7"),r("1821"),r("12d8"),r("63f3"),r("95ee"),r("0d6c"),r("eba8"),r("7241");window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var n=function(e,t){t=t||{},t.sampleBits=t.sampleBits||8,t.sampleRate=t.sampleRate||7350;var r=new(window.webkitAudioContext||window.AudioContext),n=r.createMediaStreamSource(e),o=r.createScriptProcessor||r.createJavaScriptNode,a=o.apply(r,[4096,1,1]),i={size:0,buffer:[],inputSampleRate:r.sampleRate,inputSampleBits:16,outputSampleRate:t.sampleRate,outputSampleBits:t.sampleBits,input:function(e){this.buffer.push(new Float32Array(e)),this.size+=e.length},compress:function(){for(var e=new Float32Array(this.size),t=0,r=0;r<this.buffer.length;r++)e.set(this.buffer[r],t),t+=this.buffer[r].length;var n=parseInt(this.inputSampleRate/this.outputSampleRate),o=e.length/n,a=new Float32Array(o),i=0,s=0;while(i<o)a[i]=e[s],s+=n,i++;return a},encodeWAV:function(){var e=Math.min(this.inputSampleRate,this.outputSampleRate),t=Math.min(this.inputSampleBits,this.outputSampleBits),r=this.compress(),n=r.length*(t/8),o=new ArrayBuffer(44+n),a=new DataView(o),i=1,s=0,c=function(e){for(var t=0;t<e.length;t++)a.setUint8(s+t,e.charCodeAt(t))};if(c("RIFF"),s+=4,a.setUint32(s,36+n,!0),s+=4,c("WAVE"),s+=4,c("fmt "),s+=4,a.setUint32(s,16,!0),s+=4,a.setUint16(s,1,!0),s+=2,a.setUint16(s,i,!0),s+=2,a.setUint32(s,e,!0),s+=4,a.setUint32(s,i*e*(t/8),!0),s+=4,a.setUint16(s,i*(t/8),!0),s+=2,a.setUint16(s,t,!0),s+=2,c("data"),s+=4,a.setUint32(s,n,!0),s+=4,8===t)for(var l=0;l<r.length;l++,s++){var u=Math.max(-1,Math.min(1,r[l])),d=u<0?32768*u:32767*u;d=parseInt(255/(65535/(d+32768))),a.setInt8(s,d,!0)}else for(var p=0;p<r.length;p++,s+=2){var f=Math.max(-1,Math.min(1,r[p]));a.setInt16(s,f<0?32768*f:32767*f,!0)}return new Blob([a],{type:"audio/mp3"})}};this.start=function(){n.connect(a),a.connect(r.destination)},this.stop=function(){a.disconnect()},this.getBlob=function(){return this.stop(),i.encodeWAV()},this.play=function(e){var t=document.getElementById("downloadRec");t.href=window.URL.createObjectURL(this.getBlob()),t.download=(new Date).toLocaleString()+".mp3",e.src=window.URL.createObjectURL(this.getBlob())},this.upload=function(e,t){var r=new FormData;r.append("audioData",this.getBlob());var n=new XMLHttpRequest;t&&(n.upload.addEventListener("progress",(function(e){t("uploading",e)}),!1),n.addEventListener("load",(function(e){t("ok",e)}),!1),n.addEventListener("error",(function(e){t("error",e)}),!1),n.addEventListener("abort",(function(e){t("cancel",e)}),!1)),n.open("POST",e),n.send(r)},a.onaudioprocess=function(e){i.input(e.inputBuffer.getChannelData(0))}};n.throwError=function(e){throw alert(e),new function(){this.toString=function(){return e}}},n.canRecording=null!=navigator.getUserMedia,n.get=function(e,t){if(e){if(!navigator.getUserMedia)return void n.throwErr("当前浏览器不支持录音功能。");navigator.getUserMedia({audio:!0},(function(r){var o=new n(r,t);e(o)}),(function(e){switch(e.code||e.name){case"PERMISSION_DENIED":case"PermissionDeniedError":n.throwError("用户拒绝提供信息。");break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":n.throwError("浏览器不支持硬件设备。");break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":n.throwError("无法发现指定的硬件设备。");break;default:n.throwError("无法打开麦克风。异常信息:"+(e.code||e.name));break}}))}},t["a"]=n}}]);